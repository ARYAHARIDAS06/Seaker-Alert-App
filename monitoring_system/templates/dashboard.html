<!-- metrics/templates/metrics/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>System Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>System Monitoring Dashboard</h1>

    <!-- Current Metrics -->
    <h2>Current Metrics</h2>
    <p>CPU Usage: {{ current_metrics.cpu_usage }}%</p>
    <p>RAM Usage: {{ current_metrics.ram_usage }} GB</p>
    <p>Disk Usage: {{ current_metrics.disk_usage }} GB</p>
    <p>Uptime: {{ current_metrics.uptime }} hours</p>
    <p>Temperature: {{ current_metrics.temperature }} °C</p>

    <!-- Historical Metrics Table -->
    <h2>Historical Metrics</h2>
    <table border="1">
        <tr>
            <th>Timestamp</th>
            <th>CPU Usage</th>
            <th>RAM Usage</th>
            <th>Disk Usage</th>
            <th>Uptime</th>
            <th>Temperature</th>
        </tr>
        {% for data in historical_data %}
        <tr>
            <td>{{ data.timestamp }}</td>
            <td>{{ data.cpu_usage }}%</td>
            <td>{{ data.ram_usage }} GB</td>
            <td>{{ data.disk_usage }} GB</td>
            <td>{{ data.uptime }} hours</td>
            <td>{{ data.temperature }}</td>
        </tr>
        {% endfor %}
    </table>
      <!-- Threshold Settings Form -->
    <h2>Threshold Settings</h2>
    <form method="POST" action="{% url 'update_threshold' %}">
        {% csrf_token %}
        <label>CPU Usage Threshold (%):</label>
        <input type="number" name="cpu_usage_threshold" value="{{ threshold.cpu_usage_threshold }}"><br>
        <label>RAM Usage Threshold (GB):</label>
        <input type="number" name="ram_usage_threshold" value="{{ threshold.ram_usage_threshold }}"><br>
        <label>Disk Usage Threshold (GB):</label>
        <input type="number" name="disk_usage_threshold" value="{{ threshold.disk_usage_threshold }}"><br>
        <label>Uptime Threshold (Hours):</label>
        <input type="number" name="uptime_threshold" value="{{ threshold.uptime_threshold }}"><br>
        <label>Temperature Threshold (°C):</label>
        <input type="number" name="temperature_threshold" value="{{ threshold.temperature_threshold }}"><br>
        <button type="submit">Update Thresholds</button>
    </form>

    <!-- Visualization -->
    <h2>Metrics Visualization</h2>
    <canvas id="cpuChart"></canvas>
    <canvas id="ramChart"></canvas>
    <canvas id="diskChart"></canvas>
    <canvas id="uptimeChart"></canvas>

    <script>
        // CPU Chart
        var ctxCPU = document.getElementById('cpuChart').getContext('2d');
        var cpuChart = new Chart(ctxCPU, {
            type: 'line',
            data: {
                labels: [{% for data in historical_data %}'{{ data.timestamp }}',{% endfor %}],
                datasets: [{
                    label: 'CPU Usage (%)',
                    data: [{% for data in historical_data %}{{ data.cpu_usage }},{% endfor %}],
                    borderColor: 'rgb(255, 99, 132)',
                    fill: false,
                }]
            },
        });

        // RAM Chart
        var ctxRAM = document.getElementById('ramChart').getContext('2d');
        var ramChart = new Chart(ctxRAM, {
            type: 'line',
            data: {
                labels: [{% for data in historical_data %}'{{ data.timestamp }}',{% endfor %}],
                datasets: [{
                    label: 'RAM Usage (GB)',
                    data: [{% for data in historical_data %}{{ data.ram_usage }},{% endfor %}],
                    borderColor: 'rgb(54, 162, 235)',
                    fill: false,
                }]
            },
        });

        // Disk Chart
        var ctxDisk = document.getElementById('diskChart').getContext('2d');
        var diskChart = new Chart(ctxDisk, {
            type: 'line',
            data: {
                labels: [{% for data in historical_data %}'{{ data.timestamp }}',{% endfor %}],
                datasets: [{
                    label: 'Disk Usage (GB)',
                    data: [{% for data in historical_data %}{{ data.disk_usage }},{% endfor %}],
                    borderColor: 'rgb(75, 192, 192)',
                    fill: false,
                }]
            },
        });

        // Uptime Chart
        var ctxUptime = document.getElementById('uptimeChart').getContext('2d');
        var uptimeChart = new Chart(ctxUptime, {
            type: 'line',
            data: {
                labels: [{% for data in historical_data %}'{{ data.timestamp }}',{% endfor %}],
                datasets: [{
                    label: 'Uptime (Hours)',
                    data: [{% for data in historical_data %}{{ data.uptime }},{% endfor %}],
                    borderColor: 'rgb(153, 102, 255)',
                    fill: false,
                }]
            },
        });

        function fetchAlerts() {
    fetch('/get-alerts/')
        .then(response => response.json())
        .then(data => {
            if (data.alerts.length > 0) {
                data.alerts.forEach(alert => {
                    // Display each alert using window.alert
                    window.alert(alert);
                });
            }
        })
        .catch(error => console.error('Error fetching alerts:', error));
}

// Fetch alerts every 10 seconds
setInterval(fetchAlerts, 10000);

// Initial fetch on page load
document.addEventListener('DOMContentLoaded', fetchAlerts);

    </script>
</body>
</html>
